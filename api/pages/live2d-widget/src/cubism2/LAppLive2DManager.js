{"title":"","type":"page","uid":"1cd19fc71517798e2fa5b7457d1fb06e","text":"/* global Live2D */ import { Live2DFramework } from './Live2DFramework.js'; import LAppModel from './LAppModel.js'; import PlatformManager f...","date":"2025-11-18T04:43:50.343Z","updated":"2025-11-18T04:43:50.343Z","comments":true,"path":"api/pages/live2d-widget/src/cubism2/LAppLive2DManager.js","covers":null,"content":"/* global Live2D */\nimport { Live2DFramework } from './Live2DFramework.js';\nimport LAppModel from './LAppModel.js';\nimport PlatformManager from './PlatformManager.js';\nimport LAppDefine from './LAppDefine.js';\nimport logger from '../logger.js';\n\nclass LAppLive2DManager {\n  constructor() {\n    this.model = null;\n    this.reloading = false;\n\n    Live2D.init();\n    Live2DFramework.setPlatformManager(new PlatformManager());\n  }\n\n  getModel() {\n    return this.model;\n  }\n\n  releaseModel(gl) {\n    if (this.model) {\n      this.model.release(gl);\n      this.model = null;\n    }\n  }\n\n  async changeModel(gl, modelSettingPath) {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    return new Promise((resolve, reject) => {\n      if (this.reloading) return;\n      this.reloading = true;\n\n      const oldModel = this.model;\n      const newModel = new LAppModel();\n\n      newModel.load(gl, modelSettingPath, () => {\n        if (oldModel) {\n          oldModel.release(gl);\n        }\n        this.model = newModel;\n        this.reloading = false;\n        resolve();\n      });\n    });\n  }\n\n  async changeModelWithJSON(gl, modelSettingPath, modelSetting) {\n    if (this.reloading) return;\n    this.reloading = true;\n\n    const oldModel = this.model;\n    const newModel = new LAppModel();\n\n    await newModel.loadModelSetting(modelSettingPath, modelSetting);\n    if (oldModel) {\n      oldModel.release(gl);\n    }\n    this.model = newModel;\n    this.reloading = false;\n  }\n\n  setDrag(x, y) {\n    if (this.model) {\n      this.model.setDrag(x, y);\n    }\n  }\n\n  maxScaleEvent() {\n    logger.trace('Max scale event.');\n    if (this.model) {\n      this.model.startRandomMotion(\n        LAppDefine.MOTION_GROUP_PINCH_IN,\n        LAppDefine.PRIORITY_NORMAL,\n      );\n    }\n  }\n\n  minScaleEvent() {\n    logger.trace('Min scale event.');\n    if (this.model) {\n      this.model.startRandomMotion(\n        LAppDefine.MOTION_GROUP_PINCH_OUT,\n        LAppDefine.PRIORITY_NORMAL,\n      );\n    }\n  }\n\n  tapEvent(x, y) {\n    logger.trace('tapEvent view x:' + x + ' y:' + y);\n\n    if (!this.model) return false;\n\n    if (this.model.hitTest(LAppDefine.HIT_AREA_HEAD, x, y)) {\n      logger.trace('Tap face.');\n      this.model.setRandomExpression();\n    } else if (this.model.hitTest(LAppDefine.HIT_AREA_BODY, x, y)) {\n      logger.trace('Tap body.');\n      this.model.startRandomMotion(\n        LAppDefine.MOTION_GROUP_TAP_BODY,\n        LAppDefine.PRIORITY_NORMAL,\n      );\n    }\n    return true;\n  }\n}\n\nexport default LAppLive2DManager;\n","count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"toc":"","data":[]}