{"title":"","type":"page","uid":"1cd19fc71517798e2fa5b7457d1fb06e","text":" 看板娘聊天平台 html, body { height: 100%; } body { display: flex; align-items: center; justify-content: center; padding-top: 40px; padding-bottom:...","date":"2025-11-18T04:43:50.325Z","updated":"2025-11-18T04:43:50.325Z","comments":true,"path":"api/pages/live2d-widget/demo/chat.html","covers":null,"excerpt":"","content":"<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\n<title>看板娘聊天平台</title>\n<link rel=\"stylesheet\" href=\"https://fastly.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css\">\n<link rel=\"stylesheet\" href=\"https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css\">\n<script src=\"../dist/live2d.min.js\"></script>\n<style>\nhtml, body {\n\theight: 100%;\n}\nbody {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tpadding-top: 40px;\n\tpadding-bottom: 40px;\n\tbackground-color: #f5f5f5;\n}\n#waifu {\n\tbottom: 0;\n\tleft: 0;\n\tline-height: 0;\n\tmargin-bottom: -10px;\n\tposition: fixed;\n\ttransform: translateY(3px);\n\ttransition: transform .3s ease-in-out, bottom 3s ease-in-out;\n\tz-index: 1;\n}\n#waifu:hover {\n\ttransform: translateY(0);\n}\n#waifu-tips {\n\tanimation: shake 50s ease-in-out 5s infinite;\n\tbackground-color: rgba(236, 217, 188, .5);\n\tborder: 1px solid rgba(224, 186, 140, .62);\n\tborder-radius: 12px;\n\tbox-shadow: 0 3px 15px 2px rgba(191, 158, 118, .2);\n\tfont-size: 14px;\n\tline-height: 24px;\n\tmargin: -100px 20px;\n\tmin-height: 70px;\n\toverflow: hidden;\n\tpadding: 5px 10px;\n\tposition: absolute;\n\ttext-overflow: ellipsis;\n\ttransition: opacity 1s;\n\twidth: 250px;\n\tword-break: break-all;\n}\n#waifu-tips.waifu-tips-active {\n\topacity: 1;\n\ttransition: opacity .2s;\n}\n#waifu-tips span {\n\tcolor: #0099cc;\n}\n#live2d {\n\tcursor: grab;\n\theight: 300px;\n\tposition: relative;\n\twidth: 300px;\n}\n#live2d:active {\n\tcursor: grabbing;\n}\ntextarea {\n\tbackground-color: transparent;\n    border: none;\n\twidth: 100%;\n\tresize: none;\n\tmin-height: 100px;\n}\ntextarea:focus {\n  outline: none;\n}\n</style>\n</head>\n<body>\n\t<div id=\"waifu\">\n\t\t<div id=\"waifu-tips\"><textarea id=\"text\" disabled=\"true\"></textarea></div>\n\t\t<canvas id=\"live2d\" width=\"800\" height=\"800\"></canvas>\n\t</div>\n<script type=\"module\">\n/*\n * _(:з」∠)_\n * Created by Shuqiao Zhang in 2025.\n * https://zhangshuqiao.org\n */\n\n/*\n * This program is free software: you can redistribute it and/or modify\n *  it under the terms of the GNU General Public License as published by\n *  the Free Software Foundation, either version 3 of the License, or\n *  (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n *  but WITHOUT ANY WARRANTY; without even the implied warranty of\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n *  GNU General Public License for more details.\n */\nimport { Cubism2Model } from \"../build/index.js\";\n\nclass ChatManager {\n\tconstructor() {\n\t\tthis.apiUrl = null;\n\t\tthis.apiKey = null;\n\t\tthis.conversationHistory = [];\n\t\tthis.systemPrompt = '请扮演Potion Maker中的Pio，在接下来的对话中，使用萌萌哒的语气回答问题。';\n\t}\n\n\tasync create() {\n\t\t// 提示用户输入API URL和Key\n\t\tthis.apiUrl = prompt(\"请输入大模型API URL (例如: https://api.openai.com/v1/chat/completions):\");\n\t\tif (!this.apiUrl) {\n\t\t\treturn \"呜呜~ 你没有输入API URL呢，Pio无法开始对话啦~\";\n\t\t}\n\n\t\tthis.apiKey = prompt(\"请输入API Key:\");\n\t\tif (!this.apiKey) {\n\t\t\treturn \"呜呜~ 你没有输入API Key呢，Pio无法开始对话啦~\";\n\t\t}\n\n\t\t// 初始化对话历史，添加系统提示词\n\t\tthis.conversationHistory = [\n\t\t\t{\n\t\t\t\trole: \"system\",\n\t\t\t\tcontent: this.systemPrompt\n\t\t\t}\n\t\t];\n\n\t\treturn \"嗨~ 我是Pio哦！有什么可以帮助你的吗？(按Enter发送消息)\";\n\t}\n\n\tasync message(content) {\n\t\tif (!this.apiUrl || !this.apiKey) {\n\t\t\treturn \"呜呜~ API配置不完整，请刷新页面重新配置~\";\n\t\t}\n\n\t\t// 添加用户消息到历史\n\t\tthis.conversationHistory.push({\n\t\t\trole: \"user\",\n\t\t\tcontent: content\n\t\t});\n\n\t\ttry {\n\t\t\tconst response = await fetch(this.apiUrl, {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: {\n\t\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t\t'Authorization': `Bearer ${this.apiKey}`\n\t\t\t\t},\n\t\t\t\tbody: JSON.stringify({\n\t\t\t\t\tmessages: this.conversationHistory,\n\t\t\t\t\ttemperature: 0.7,\n\t\t\t\t\tmax_tokens: 1000\n\t\t\t\t})\n\t\t\t});\n\n\t\t\tif (!response.ok) {\n\t\t\t\tthrow new Error(`API请求失败: ${response.status} ${response.statusText}`);\n\t\t\t}\n\n\t\t\tconst data = await response.json();\n\t\t\tconst assistantMessage = data.choices[0].message.content;\n\n\t\t\t// 添加助手回复到历史\n\t\t\tthis.conversationHistory.push({\n\t\t\t\trole: \"assistant\",\n\t\t\t\tcontent: assistantMessage\n\t\t\t});\n\n\t\t\treturn assistantMessage;\n\t\t} catch (error) {\n\t\t\tconsole.error(\"API调用出错:\", error);\n\t\t\treturn `呜呜~ 出错了呢: ${error.message}`;\n\t\t}\n\t}\n}\n\nwindow.addEventListener(\"load\", async () => {\n\t\"use strict\";\n\n\tconst apiPath = \"https://live2d.fghrsh.net/api\";\n\tconst text = document.getElementById(\"text\");\n\tconst manager = new ChatManager();\n\tlet state = 0, loading = false,\n\t\tmodelId = localStorage.getItem(\"modelId\"),\n\t\tmodelTexturesId = localStorage.getItem(\"modelTexturesId\");\n\tif (modelId === null) {\n\t\tmodelId = 1;\n\t\tmodelTexturesId = 53;\n\t}\n\tconst model = new Cubism2Model();\n\tawait loadModel(modelId, modelTexturesId);\n\n\tasync function loadModel(modelId, modelTexturesId) {\n\t\tlocalStorage.setItem(\"modelId\", modelId);\n\t\tif (modelTexturesId === undefined) modelTexturesId = 0;\n\t\tlocalStorage.setItem(\"modelTexturesId\", modelTexturesId);\n\t\tconst modelSettingPath = `${apiPath}/get/?id=${modelId}-${modelTexturesId}`;\n\t\tconst response = await fetch(modelSettingPath);\n\t\tconst modelSetting = await response.json();\n\t\tif (!model.gl) {\n\t\t\tawait model.init('live2d', modelSettingPath, modelSetting);\n\t\t} else {\n\t\t\tawait model.changeModelWithJSON(modelSettingPath, modelSetting);\n\t\t}\n\t\tconsole.log(\"live2d\", `模型 ${modelId}-${modelTexturesId} 加载完成`);\n\t\tsetTimeout(() => {\n\t\t\tstate = 2;\n\t\t}, 2000);\n\t}\n\n\ttext.addEventListener(\"keydown\", async (e) => {\n\t\tif (e.code === \"Enter\") {\n\t\t\te.preventDefault();\n\t\t\tlet content = text.value;\n\t\t\tif (content === \"\") return;\n\t\t\tconsole.log(content);\n\t\t\ttext.disabled = true;\n\t\t\ttext.value = await manager.message(content);\n\t\t\ttext.disabled = false;\n\t\t}\n\t});\n\n\tconst message = await manager.create();\n\ttext.value = message;\n\ttext.disabled = false;\n});\n</script>\n</body>\n</html>\n","count_time":{"symbolsCount":"5.1k","symbolsTime":"5 mins."},"toc":"","data":[]}