{"title":"","type":"page","uid":"1cd19fc71517798e2fa5b7457d1fb06e","text":"import { Live2DFramework } from './Live2DFramework.js'; import LAppModel from './LAppModel.js'; import PlatformManager from './PlatformManag...","date":"2025-11-18T04:43:50.314Z","updated":"2025-11-18T04:43:50.314Z","comments":true,"path":"api/pages/live2d-widget/build/cubism2/LAppLive2DManager.js","covers":null,"content":"import { Live2DFramework } from './Live2DFramework.js';\nimport LAppModel from './LAppModel.js';\nimport PlatformManager from './PlatformManager.js';\nimport LAppDefine from './LAppDefine.js';\nimport logger from '../logger.js';\nclass LAppLive2DManager {\n    constructor() {\n        this.model = null;\n        this.reloading = false;\n        Live2D.init();\n        Live2DFramework.setPlatformManager(new PlatformManager());\n    }\n    getModel() {\n        return this.model;\n    }\n    releaseModel(gl) {\n        if (this.model) {\n            this.model.release(gl);\n            this.model = null;\n        }\n    }\n    async changeModel(gl, modelSettingPath) {\n        return new Promise((resolve, reject) => {\n            if (this.reloading)\n                return;\n            this.reloading = true;\n            const oldModel = this.model;\n            const newModel = new LAppModel();\n            newModel.load(gl, modelSettingPath, () => {\n                if (oldModel) {\n                    oldModel.release(gl);\n                }\n                this.model = newModel;\n                this.reloading = false;\n                resolve();\n            });\n        });\n    }\n    async changeModelWithJSON(gl, modelSettingPath, modelSetting) {\n        if (this.reloading)\n            return;\n        this.reloading = true;\n        const oldModel = this.model;\n        const newModel = new LAppModel();\n        await newModel.loadModelSetting(modelSettingPath, modelSetting);\n        if (oldModel) {\n            oldModel.release(gl);\n        }\n        this.model = newModel;\n        this.reloading = false;\n    }\n    setDrag(x, y) {\n        if (this.model) {\n            this.model.setDrag(x, y);\n        }\n    }\n    maxScaleEvent() {\n        logger.trace('Max scale event.');\n        if (this.model) {\n            this.model.startRandomMotion(LAppDefine.MOTION_GROUP_PINCH_IN, LAppDefine.PRIORITY_NORMAL);\n        }\n    }\n    minScaleEvent() {\n        logger.trace('Min scale event.');\n        if (this.model) {\n            this.model.startRandomMotion(LAppDefine.MOTION_GROUP_PINCH_OUT, LAppDefine.PRIORITY_NORMAL);\n        }\n    }\n    tapEvent(x, y) {\n        logger.trace('tapEvent view x:' + x + ' y:' + y);\n        if (!this.model)\n            return false;\n        if (this.model.hitTest(LAppDefine.HIT_AREA_HEAD, x, y)) {\n            logger.trace('Tap face.');\n            this.model.setRandomExpression();\n        }\n        else if (this.model.hitTest(LAppDefine.HIT_AREA_BODY, x, y)) {\n            logger.trace('Tap body.');\n            this.model.startRandomMotion(LAppDefine.MOTION_GROUP_TAP_BODY, LAppDefine.PRIORITY_NORMAL);\n        }\n        return true;\n    }\n}\nexport default LAppLive2DManager;\n","count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"toc":"","data":[]}