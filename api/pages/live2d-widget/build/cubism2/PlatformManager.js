{"title":"","type":"page","uid":"1cd19fc71517798e2fa5b7457d1fb06e","text":"import logger from '../logger.js'; class PlatformManager { constructor() { this.cache = {}; } loadBytes(path, callback) { if (path in this.c...","date":"2025-11-18T04:43:50.316Z","updated":"2025-11-18T04:43:50.316Z","comments":true,"path":"api/pages/live2d-widget/build/cubism2/PlatformManager.js","covers":null,"content":"import logger from '../logger.js';\nclass PlatformManager {\n    constructor() {\n        this.cache = {};\n    }\n    loadBytes(path, callback) {\n        if (path in this.cache) {\n            return callback(this.cache[path]);\n        }\n        fetch(path)\n            .then(response => response.arrayBuffer())\n            .then(arrayBuffer => {\n            this.cache[path] = arrayBuffer;\n            callback(arrayBuffer);\n        });\n    }\n    loadLive2DModel(path, callback) {\n        let model = null;\n        this.loadBytes(path, buf => {\n            model = Live2DModelWebGL.loadModel(buf);\n            callback(model);\n        });\n    }\n    loadTexture(model, no, path, callback) {\n        const loadedImage = new Image();\n        loadedImage.crossOrigin = 'anonymous';\n        loadedImage.src = path;\n        loadedImage.onload = () => {\n            const canvas = document.getElementById('live2d');\n            const gl = canvas.getContext('webgl2', { premultipliedAlpha: true, preserveDrawingBuffer: true });\n            let texture = gl.createTexture();\n            if (!texture) {\n                logger.error('Failed to generate gl texture name.');\n                return -1;\n            }\n            if (model.isPremultipliedAlpha() == false) {\n                gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);\n            }\n            gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 1);\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, loadedImage);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);\n            gl.generateMipmap(gl.TEXTURE_2D);\n            model.setTexture(no, texture);\n            texture = null;\n            if (typeof callback == 'function')\n                callback();\n        };\n        loadedImage.onerror = () => {\n            logger.error('Failed to load image : ' + path);\n        };\n    }\n    jsonParseFromBytes(buf) {\n        let jsonStr;\n        const bomCode = new Uint8Array(buf, 0, 3);\n        if (bomCode[0] == 239 && bomCode[1] == 187 && bomCode[2] == 191) {\n            jsonStr = String.fromCharCode.apply(null, new Uint8Array(buf, 3));\n        }\n        else {\n            jsonStr = String.fromCharCode.apply(null, new Uint8Array(buf));\n        }\n        const jsonObj = JSON.parse(jsonStr);\n        return jsonObj;\n    }\n}\nexport default PlatformManager;\n","count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"toc":"","data":[]}