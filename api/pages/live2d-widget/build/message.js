{"title":"","type":"page","uid":"1cd19fc71517798e2fa5b7457d1fb06e","text":"import { randomSelection } from './utils.js'; let messageTimer = null; function showMessage(text, timeout, priority, override = true) { let ...","date":"2025-11-18T04:43:50.324Z","updated":"2025-11-18T04:43:50.324Z","comments":true,"path":"api/pages/live2d-widget/build/message.js","covers":null,"content":"import { randomSelection } from './utils.js';\nlet messageTimer = null;\nfunction showMessage(text, timeout, priority, override = true) {\n    let currentPriority = parseInt(sessionStorage.getItem('waifu-message-priority'), 10);\n    if (isNaN(currentPriority)) {\n        currentPriority = 0;\n    }\n    if (!text ||\n        (override && currentPriority > priority) ||\n        (!override && currentPriority >= priority))\n        return;\n    if (messageTimer) {\n        clearTimeout(messageTimer);\n        messageTimer = null;\n    }\n    text = randomSelection(text);\n    sessionStorage.setItem('waifu-message-priority', String(priority));\n    const tips = document.getElementById('waifu-tips');\n    tips.innerHTML = text;\n    tips.classList.add('waifu-tips-active');\n    messageTimer = setTimeout(() => {\n        sessionStorage.removeItem('waifu-message-priority');\n        tips.classList.remove('waifu-tips-active');\n    }, timeout);\n}\nfunction welcomeMessage(time, welcomeTemplate, referrerTemplate) {\n    if (location.pathname === '/') {\n        for (const { hour, text } of time) {\n            const now = new Date(), after = hour.split('-')[0], before = hour.split('-')[1] || after;\n            if (Number(after) <= now.getHours() &&\n                now.getHours() <= Number(before)) {\n                return text;\n            }\n        }\n    }\n    if (!welcomeTemplate)\n        return '';\n    const text = i18n(welcomeTemplate, document.title);\n    if (document.referrer === '' || !referrerTemplate)\n        return text;\n    const referrer = new URL(document.referrer);\n    if (location.hostname === referrer.hostname)\n        return text;\n    return `${i18n(referrerTemplate, referrer.hostname)}<br>${text}`;\n}\nfunction i18n(template, ...args) {\n    return template.replace(/\\$(\\d+)/g, (_, idx) => {\n        var _b;\n        const i = parseInt(idx, 10) - 1;\n        return (_b = args[i]) !== null && _b !== void 0 ? _b : '';\n    });\n}\nexport { showMessage, welcomeMessage, i18n };\n","count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"toc":"","data":[]}